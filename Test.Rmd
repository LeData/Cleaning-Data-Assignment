---
title: "Getting and Cleaning Data Week 4 - Assignment"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
```

## The Source

  This data is taken from the [Human Activity Recognition Using Smartphones Data Set ](http://archive.ics.uci.edu/ml/datasets/Human+Activity+Recognition+Using+Smartphones#), a publicly acessible dataset available on the UCI Machine Learning Repository.  It was collected by Jorge L. Reyes-Ortiz(1,2), Davide Anguita(1), Alessandro Ghio(1), Luca Oneto(1) and Xavier Parra(2).
  
  Here is a description of the experiment from the UCI page:
  
> The experiments have been carried out with a group of 30 volunteers within an age bracket of 19-48 years. Each person performed six activities (WALKING, WALKING_UPSTAIRS, WALKING_DOWNSTAIRS, SITTING, STANDING, LAYING) wearing a smartphone (Samsung Galaxy S II) on the waist. Using its embedded accelerometer and gyroscope, they captured 3-axial linear acceleration and 3-axial angular velocity at a constant rate of 50Hz. The experiments have been video-recorded to label the data manually.

*1 - Smartlab - Non-Linear Complex Systems Laboratory
DITEN - Università degli Studi di Genova, Genoa (I-16145), Italy.*

*2 - CETpD - Technical Research Centre for Dependency Care and Autonomous Living
Universitat Politècnica de Catalunya (BarcelonaTech). Vilanova i la Geltrú (08800), Spain*

## The Work
  
  We collected their training and testing sets into one data set and kept the **means** and **standard deviations** of the main variables:
  
* tBodyAcc-XYZ
* tGravityAcc-XYZ
* tBodyAccJerk-XYZ
* tBodyGyro-XYZ
* tBodyGyroJerk-XYZ
* tBodyAccMag
* tGravityAccMag
* tBodyAccJerkMag
* tBodyGyroMag
* tBodyGyroJerkMag
* fBodyAcc-XYZ
* fBodyAccJerk-XYZ
* fBodyGyro-XYZ
* fBodyAccMag
* fBodyAccJerkMag
* fBodyGyroMag
* fBodyGyroJerkMag
  
  The description of these variable is also given by the authors:
  
> The features selected for this database come from the accelerometer and gyroscope 3-axial raw signals tAcc-XYZ and tGyro-XYZ. These time domain signals (prefix 't' to denote time) were captured at a constant rate of 50 Hz. Then they were filtered using a median filter and a 3rd order low pass Butterworth filter with a corner frequency of 20 Hz to remove noise. Similarly, the acceleration signal was then separated into body and gravity acceleration signals (tBodyAcc-XYZ and tGravityAcc-XYZ) using another low pass Butterworth filter with a corner frequency of 0.3 Hz. 
>
> Subsequently, the body linear acceleration and angular velocity were derived in time to obtain Jerk signals (tBodyAccJerk-XYZ and tBodyGyroJerk-XYZ). Also the magnitude of these three-dimensional signals were calculated using the Euclidean norm (tBodyAccMag, tGravityAccMag, tBodyAccJerkMag, tBodyGyroMag, tBodyGyroJerkMag). 
>
> Finally a Fast Fourier Transform (FFT) was applied to some of these signals producing fBodyAcc-XYZ, fBodyAccJerk-XYZ, fBodyGyro-XYZ, fBodyAccJerkMag, fBodyGyroMag, fBodyGyroJerkMag. (Note the 'f' to indicate frequency domain signals). 
>
> These signals were used to estimate variables of the feature vector for each pattern:  
'-XYZ' is used to denote 3-axial signals in the X, Y and Z directions.

  Note that the authors had included some other variable's means in the data but they did not have a standard deviation associated to them so we decided to drop them.
  
  We then computed the means of all these variables grouped by subjects and activities and stored them in a new table.


## The Code

First we make a vector of Subjects from both the training and the testing set.
Then we turn these into factors for easy grouping.

```{r Subjects}
Subj_table<-rbind(read.table("UCI HAR Dataset/train/subject_train.txt",col.names = 'subjects'),
                  read.table("UCI HAR Dataset/test/subject_test.txt",col.names = 'subjects'))
Subj_table$subjects<-as.factor(Subj_table$subjects)
```

```{r, echo=FALSE}
str(Subj_table)
```

We make a data frame with the types of activities done in the experiment. 
We collect the activity data from the training and tesing set, label the column and set the names as factors appropriately.

```{r Actions}
Act<-read.table('UCI HAR Dataset/activity_labels.txt')
Act_table<-rbind(read.table("UCI HAR Dataset/train/y_train.txt",col.names = 'activity'),
                 read.table("UCI HAR Dataset/test/y_test.txt",col.names = 'activity'))
Act_table$activity<-factor(Act_table$activity,levels=Act[[1]],labels=Act[[2]])
```

```{r, echo=FALSE}
str(Act_table)
```

We collect the names of the variables as a character vector, so as to later pass them easily to the main data as column names.

```{r Variables}
names<-read.table("UCI HAR Dataset/features.txt",as.is=TRUE)[[2]]
```

```{r, echo=FALSE}
str(names)
```

We finally collect the data from the experiment, keep the rows corresponding to means of the given variables. 
add the Subject and Activity factors and clean up.

```{r MainData}
Data_table<-rbind(read.table("UCI HAR Dataset/train/x_train.txt",col.names = names),
                  read.table("UCI HAR Dataset/test/x_test.txt",col.names = names))%>%
    select(matches('std\\(\\)|(mean\\(\\))',vars=names))
All_table<-cbind(Subj_table,Act_table,Data_table)
rm(Subj_table,Act_table,Data_table)
```

```{r, echo=FALSE}
str(All_table)
```

Finally we create a separate table computing the average of the variables by activity and by subject
```{r Means}
Avg_table<-All_table%>%group_by(activity,subjects)%>%summarize_all(mean)
```

```{r,echo=FALSE}
Avg_table
```

